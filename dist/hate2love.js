!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r.w={},r(r.s=2)}([function(e,t){e.exports=require("underscore")},function(e,t){e.exports=require("backbone")},function(e,t,r){"use strict";r.r(t);var n=r(1),i=r.n(n),s=r(0),a=r.n(s);var o={createLinkResolver:function(e,t,r){return new Promise(function(n,i){Backbone.ajax({url:t,success:function(t){var i=t;a.a.has(t,"_embedded")&&(i=t._embedded);var s=a.a.findWhere(r._descriptor.descriptors,{name:e});if(s&&a.a.has(s,"rt")){var o=Backbone.HAL.registry[s.rt];i=i[o._name],i=a.a.isArray(i)?a.a.map(i,function(e){return new o(e,{parse:!0})}):new o(t,{parse:!0})}r.set(e,i),n({model:r,propertyName:e})},error:function(e,t){404==e.status?n():i()}})})},resolveModelReference:function e(t){return a.a.isArray(t)?a.a.map(t,e):a.a.isDate(t)?t.toJSON():a.a.isObject(t)?a.a.has(t,"cid")?t.url():a.a.mapObject(t,e):t},transformNested:function e(t,r,n){if(r.length>0){var i=r.splice(0,1);return a.a.isArray(t[i])?t[i]=a.a.map(t[i],function(t){return e(t,r,n)}):a.a.isObject(t[i])&&(t[i]=e(t[i],r,n)),t}return!a.a.isObject(t)||a.a.isArray(t)||a.a.has(t,"cid")?t:new n(t)}};var c={embedded:{},links:{},getEmbedded(){return this.embedded},getLinks(){return this.links},getLink(e){let t;return a.a.isArray(this.links)?1===(t=a.a.where(this.links,{rel:e})).length&&(t=t[0]):a.a.isUndefined(this.links[e])||(t=this.links[e]),t},removeLink(e){a.a.isArray(this.links)?this.links=a.a.reject(this.links,function(t){return t.rel==e}):a.a.isUndefined(this.links[e])||delete this.links[e]}},l={parse(e){return e=e||{},this.links=e._links||{},this.embedded=e._embedded||{},delete e._links,delete e._embedded,e},fetchLink(e){var t=this.links[e];if(a.a.isUndefined(t))throw"link does not exist for property: "+e;return t.href.replace("{?projection}","")!=this.url()?o.createLinkResolver(e,t.href,this):null},fetchLinks(){var e=[];return a.a.each(this.links,function(t,r){t.href.replace("{?projection}","")!=this.url()&&e.push(o.createLinkResolver(r,t.href,this))},this),Promise.all(e)},url:function(){var e=this.getLink("self");return e?e.href:l.__super__.url.call(this)},isNew:function(){return!this.getLink("self")&&!this.id},makeNew(){return this.unset(this.idAttribute,{silent:!0}),this.removeLink("self"),this},transform(e,t){var r;if(a.a.isString(t)){if(r=i.a.HAL.namespace[t],a.a.isUndefined(r))throw"class "+t+" is not registred in namespace"}else r=t;_transformNested(this,e.split("."),r)},toJSON:function(){var e,t=this.getLinks(),r=this.getEmbedded();return e=a.a.clone(this.attributes),a.a.isEmpty(r),a.a.isEmpty(t),a.a.mapObject(e,o.resolveModelReference)}};l=a.a.extend(l,c);var u=l=i.a.Model.extend(l),d={constructor:function(e,t){a.a.isArray(e)||(e=this.parse(a.a.clone(e))),d.__super__.constructor.call(this,e,t)},parse:function(e){return e=e||{},this.links=e._links||{},this.embedded=e._embedded||{},delete e._links,delete e._embedded,this.attributes=e||{},this.model.clazz?this.embedded[this._name]:this.embedded.items},reset:function(e,t){return t=t||{},a.a.isArray(e)||(e=this.parse(a.a.clone(e))),t.parse=!1,d.__super__.reset.call(this,e,t)},url:function(){var e=this.getLink("self");return e?e.href:d.__super__.url.call(this)}};d=a.a.extend(d,c);var f=d=i.a.Collection.extend(d),p={};i.a.HAL={registry:{},_options:{url:"",hal:null,namespace:window},init:function(e){this._options=_.extend(this._options,e);var t=this;return this.namespace=this._options==window?window:this._ensureNS(this._options.namespace),new Promise(function(e,r){i.a.ajax({url:t._options.url+"/profile",success:function(n){var i=[];for(var s in n._links)"self"!=i&&i.push(t._fetchResourceDef(s,n._links[s].href));Promise.all(i).then(e).catch(r)},error:r})})},_ensureNS:function(e){if(_.isObject(e))return e;e=e.split(".");for(var t=window,r=0;r<e.length;r++)t[e[r]]||(t[e[r]]={}),t=t[e[r]];return t},_fetchResourceDef:function(e,t){var r=this;return new Promise(function(n,s){i.a.ajax({url:t,success:function(i){var s=r.createModel(t,e,i);s&&r.createCollection(t,e,s),n()},error:s})})},createModel:function(e,t,r){if("self"==t)return!1;var n,s=_(t).capitalizeName();if(r.alps&&_.isArray(r.alps.descriptors)&&(n=_.find(r.alps.descriptors,function(e){var r=_(t).uncapitalizeName()+"-representation";return e.id==r})),n){if(!this.namespace[s]){var a=p[s],o={_descriptor:n,defaults:{},urlRoot:e.replace("/profile","")};_.has(a,"protoProps")&&_.extend(o,a.protoProps),_.each(n.descriptors,function(e){if("id"!=e.name&&("SEMANTIC"==e.type&&(_.has(o.defaults,e.name)||(o.defaults[e.name]="")),"SAFE"==e.type)){_.has(o.defaults,e.name)||(o.defaults[e.name]=null);_(e.name).capitalize();o["get"+_(e.name).capitalize()]=function(e){return function(){var t=this.get(e.name)||this.getEmbedded()[e.name];return t&&(_.isArray(t)?t.length&&!_.has(t[0],"cid")&&(t=this.attributes[e.name]=_.map(t,function(t){return i.a.HAL._mapClazz(t,e)})):_.has(t,"cid")||(t=this.attributes[e.name]=i.a.HAL._mapClazz(t,e))),t}}(e)}});var c={clazz:s,_name:t};_.has(a,"staticProps")&&_.extend(c,a.staticProps);var l=u.extend(o,c);return this.registry[e+"#"+n.id]=l,this.namespace[s]=l}return console.warn("classname "+s+" allready exists in namespace",this.namespace),!1}console.warn("descriptor not found for "+s)},createCollection:function(e,t,r){var n=_(t).capitalizeName()+"s";e=e.replace("/profile","");var i=p[n],s={_name:t,model:r,url:e};_.has(i,"protoProps")&&_.extend(s,i.protoProps);var a={};return _.has(i,"staticProps")&&_.extend(a,i.staticProps),this.namespace[n]=f.extend(s,a)},_mapClazz:function(e,t){if(_.has(e,"cid"))return e;var r=i.a.HAL.registry[t.rt];return r?new r(e):(console.warn("no representation found for "+t.rt),e)},extend:function(e,t,r){p[e]={protoProps:t,staticProps:r}}},i.a.HAL.Model=u,i.a.HAL.Collection=f;t.default=i.a.HAL}]);